````markdown
# Vehicle API Documentation

## üìã M·ª•c l·ª•c
- [T·ªïng quan](#t·ªïng-quan)
- [Base URL](#base-url)
- [Authentication](#authentication)
- [Danh s√°ch API](#danh-s√°ch-api)
- [Chi ti·∫øt t·ª´ng API](#chi-ti·∫øt-t·ª´ng-api)
- [Enums v√† Constants](#enums-v√†-constants)
- [Error Codes](#error-codes)
- [V√≠ d·ª• s·ª≠ d·ª•ng](#v√≠-d·ª•-s·ª≠-d·ª•ng)

---

## üéØ T·ªïng quan

Module Vehicle API cung c·∫•p c√°c ch·ª©c nƒÉng qu·∫£n l√Ω ph∆∞∆°ng ti·ªán trong h·ªá th·ªëng EV Co-ownership, bao g·ªìm:
- **T·∫°o ph∆∞∆°ng ti·ªán m·ªõi** (Co-owner c√≥ th·ªÉ t·∫°o)
- **Qu·∫£n l√Ω ƒë·ªìng s·ªü h·ªØu** (m·ªùi, ph·∫£n h·ªìi, x√≥a co-owner)
- **Xem danh s√°ch ph∆∞∆°ng ti·ªán** (role-based access)
- **L·ªãch tr√¨nh v√† t√≠nh kh·∫£ d·ª•ng** (availability schedule, find slots)
- **Ph√¢n t√≠ch s·ª≠ d·ª•ng** (utilization comparison)
- **Chi ti·∫øt ph∆∞∆°ng ti·ªán ƒë·∫ßy ƒë·ªß** (fund, co-owners, specifications)

**ƒê·∫∑c ƒëi·ªÉm ch√≠nh:**
- **Role-based Access Control**: Co-owner, Staff, Admin c√≥ quy·ªÅn kh√°c nhau
- **Advanced Filtering & Pagination**: Filter theo brand, model, price, year, etc.
- **Real-time Availability**: Ki·ªÉm tra xe tr·ªëng/b·∫≠n theo th·ªùi gian th·ª±c
- **Investment Management**: Qu·∫£n l√Ω t·ª∑ l·ªá s·ªü h·ªØu v√† kho·∫£n ƒë·∫ßu t∆∞

---

## üîó Base URL

```
http://localhost:5215/api/vehicle
```

Trong production: `https://your-domain.com/api/vehicle`

---

## üîê Authentication

T·∫•t c·∫£ endpoints y√™u c·∫ßu JWT Bearer Token trong header:

```http
Authorization: Bearer {access_token}
```

**Role Requirements:**
- **Co-owner**: C√≥ th·ªÉ t·∫°o xe, qu·∫£n l√Ω xe c·ªßa m√¨nh, xem xe trong group
- **Staff**: C√≥ th·ªÉ xem t·∫•t c·∫£ xe, h·ªó tr·ª£ qu·∫£n l√Ω
- **Admin**: Quy·ªÅn ƒë·∫ßy ƒë·ªß, c√≥ th·ªÉ qu·∫£n l√Ω m·ªçi xe

---

## üìë Danh s√°ch API

| STT | Method | Endpoint | M√¥ t·∫£ | Role Required |
|-----|--------|----------|-------|---------------|
| 1 | POST | `/` | T·∫°o ph∆∞∆°ng ti·ªán m·ªõi | Co-owner |
| 2 | POST | `/{vehicleId}/co-owners` | Th√™m ƒë·ªìng s·ªü h·ªØu | Co-owner, Staff, Admin |
| 3 | PUT | `/{vehicleId}/invitations/respond` | Ph·∫£n h·ªìi l·ªùi m·ªùi ƒë·ªìng s·ªü h·ªØu | Co-owner |
| 4 | GET | `/{vehicleId}/details` | Xem chi ti·∫øt xe (legacy) | Co-owner |
| 5 | GET | `/my-vehicles` | Xem xe c·ªßa t√¥i | Co-owner |
| 6 | GET | `/invitations/pending` | Xem l·ªùi m·ªùi ch·ªù duy·ªát | Co-owner |
| 7 | DELETE | `/{vehicleId}/co-owners/{coOwnerUserId}` | X√≥a ƒë·ªìng s·ªü h·ªØu | Co-owner, Staff, Admin |
| 8 | PUT | `/{vehicleId}` | C·∫≠p nh·∫≠t th√¥ng tin xe | Co-owner, Staff, Admin |
| 9 | GET | `/available` | Xem xe kh·∫£ d·ª•ng (v·ªõi filter) | Co-owner, Staff, Admin |
| 10 | GET | `/{vehicleId}` | Xem chi ti·∫øt xe ƒë·∫ßy ƒë·ªß | Co-owner, Staff, Admin |
| 11 | GET | `/validate-creation-eligibility` | [DEV] Ki·ªÉm tra ƒëi·ªÅu ki·ªán t·∫°o xe | Any |
| 12 | GET | `/{vehicleId}/availability/schedule` | Xem l·ªãch tr√¨nh s·ª≠ d·ª•ng xe | Co-owner, Staff, Admin |
| 13 | GET | `/{vehicleId}/availability/find-slots` | T√¨m slot tr·ªëng ƒë·ªÉ ƒë·∫∑t xe | Co-owner, Staff, Admin |
| 14 | GET | `/utilization/compare` | So s√°nh hi·ªáu su·∫•t s·ª≠ d·ª•ng | Co-owner, Staff, Admin |

---

## üìñ Chi ti·∫øt t·ª´ng API

### 1. üöó T·∫°o ph∆∞∆°ng ti·ªán m·ªõi - POST `/`

**M√¥ t·∫£:** T·∫°o ph∆∞∆°ng ti·ªán m·ªõi trong h·ªá th·ªëng. Ng∆∞·ªùi t·∫°o s·∫Ω tr·ªü th√†nh ch·ªß s·ªü h·ªØu ch√≠nh.

**Role:** Co-owner

**Request Body:**
```json
{
  "name": "Tesla Model 3 2024",
  "brand": "Tesla",
  "model": "Model 3",
  "year": 2024,
  "vin": "1HGCM82633A123456",
  "licensePlate": "51A-12345",
  "color": "Pearl White",
  "batteryCapacity": 75.0,
  "range": 448,
  "purchaseDate": "2024-01-15",
  "purchasePrice": 1500000000,
  "warrantyExpiryDate": "2027-01-15",
  "latitude": 10.762622,
  "longitude": 106.660172
}
```

**Request Schema:**
| Field | Type | Required | Validation |
|-------|------|----------|------------|
| name | string | ‚úÖ | Max 100 chars |
| brand | string | ‚úÖ | Max 50 chars |
| model | string | ‚úÖ | Max 50 chars |
| year | int | ‚úÖ | 1900-current year |
| vin | string | ‚úÖ | Exactly 17 chars, valid VIN format |
| licensePlate | string | ‚úÖ | Vietnamese license plate format |
| color | string | ‚úÖ | Max 30 chars |
| batteryCapacity | decimal | ‚úÖ | > 0 |
| range | int | ‚úÖ | > 0 (km) |
| purchaseDate | string | ‚úÖ | ISO 8601 date |
| purchasePrice | decimal | ‚úÖ | > 0 (VND) |
| warrantyExpiryDate | string | ‚ùå | ISO 8601 date |
| latitude | decimal | ‚ùå | -90 to 90 |
| longitude | decimal | ‚ùå | -180 to 180 |

**Response 201 - Th√†nh c√¥ng:**
```json
{
  "statusCode": 201,
  "message": "VEHICLE_CREATED_SUCCESSFULLY",
  "data": {
    "vehicleId": 15,
    "name": "Tesla Model 3 2024",
    "brand": "Tesla",
    "model": "Model 3",
    "vin": "1HGCM82633A123456",
    "licensePlate": "51A-12345",
    "status": "Available",
    "verificationStatus": "Pending",
    "createdAt": "2025-01-17T10:30:00Z",
    "createdBy": {
      "userId": 5,
      "fullName": "Nguyen Van A"
    }
  }
}
```

**Validation Errors:**
- `VEHICLE_NAME_REQUIRED` - T√™n xe l√† b·∫Øt bu·ªôc
- `BRAND_REQUIRED` - Th∆∞∆°ng hi·ªáu l√† b·∫Øt bu·ªôc
- `VIN_REQUIRED` - S·ªë VIN l√† b·∫Øt bu·ªôc
- `VIN_INVALID_FORMAT` - ƒê·ªãnh d·∫°ng VIN kh√¥ng h·ª£p l·ªá
- `LICENSE_PLATE_REQUIRED` - Bi·ªÉn s·ªë xe l√† b·∫Øt bu·ªôc
- `LICENSE_PLATE_INVALID_FORMAT` - ƒê·ªãnh d·∫°ng bi·ªÉn s·ªë kh√¥ng h·ª£p l·ªá
- `USER_NOT_ELIGIBLE_TO_CREATE_VEHICLE` - Ng∆∞·ªùi d√πng kh√¥ng ƒë·ªß ƒëi·ªÅu ki·ªán
- `NO_DRIVING_LICENSE_REGISTERED` - Ch∆∞a ƒëƒÉng k√Ω b·∫±ng l√°i xe
- `DRIVING_LICENSE_NOT_VERIFIED` - B·∫±ng l√°i xe ch∆∞a ƒë∆∞·ª£c x√°c minh

**Business Rules:**
- User ph·∫£i c√≥ role Co-owner
- User ph·∫£i c√≥ b·∫±ng l√°i xe ƒë√£ verified v√† ch∆∞a h·∫øt h·∫°n
- VIN v√† bi·ªÉn s·ªë xe ph·∫£i unique
- ƒê·ªãnh d·∫°ng bi·ªÉn s·ªë Vietnam: 30A-123.45 ho·∫∑c 30A-12345

---

### 2. üë• Th√™m ƒë·ªìng s·ªü h·ªØu - POST `/{vehicleId}/co-owners`

**M√¥ t·∫£:** M·ªùi ng∆∞·ªùi d√πng kh√°c tr·ªü th√†nh ƒë·ªìng s·ªü h·ªØu c·ªßa xe.

**Role:** Co-owner, Staff, Admin

**Request Body:**
```json
{
  "userId": 8,
  "ownershipPercentage": 25.0,
  "investmentAmount": 375000000
}
```

**Request Schema:**
| Field | Type | Required | Validation |
|-------|------|----------|------------|
| userId | int | ‚úÖ | Must exist, must be Co-owner role |
| ownershipPercentage | decimal | ‚úÖ | 0.1 - 99.9, not exceed available |
| investmentAmount | decimal | ‚úÖ | > 0, should match percentage |

**Response 200 - Th√†nh c√¥ng:**
```json
{
  "statusCode": 200,
  "message": "CO_OWNER_INVITATION_SENT_SUCCESSFULLY",
  "data": {
    "invitationId": 25,
    "vehicleId": 15,
    "vehicleName": "Tesla Model 3 2024",
    "targetUserId": 8,
    "targetUserName": "Tran Thi B",
    "ownershipPercentage": 25.0,
    "investmentAmount": 375000000,
    "status": "Pending",
    "createdAt": "2025-01-17T11:00:00Z"
  }
}
```

**Error Responses:**
- `TARGET_USER_NOT_CO_OWNER` - User ƒë∆∞·ª£c m·ªùi kh√¥ng c√≥ role Co-owner
- `USER_ALREADY_CO_OWNER_OF_VEHICLE` - User ƒë√£ l√† ƒë·ªìng s·ªü h·ªØu
- `OWNERSHIP_PERCENTAGE_EXCEEDS_LIMIT` - V∆∞·ª£t qu√° t·ª∑ l·ªá c√≤n l·∫°i
- `INVITATION_ALREADY_PENDING` - ƒê√£ c√≥ l·ªùi m·ªùi ch·ªù duy·ªát

---

### 3. ‚úÖ Ph·∫£n h·ªìi l·ªùi m·ªùi - PUT `/{vehicleId}/invitations/respond`

**M√¥ t·∫£:** Ch·∫•p nh·∫≠n ho·∫∑c t·ª´ ch·ªëi l·ªùi m·ªùi ƒë·ªìng s·ªü h·ªØu.

**Role:** Co-owner

**Request Body:**
```json
{
  "response": true
}
```

**Request Schema:**
| Field | Type | Required | Values |
|-------|------|----------|--------|
| response | boolean | ‚úÖ | true = accept, false = reject |

**Response 200 - Ch·∫•p nh·∫≠n:**
```json
{
  "statusCode": 200,
  "message": "INVITATION_ACCEPTED_SUCCESSFULLY",
  "data": {
    "vehicleId": 15,
    "vehicleName": "Tesla Model 3 2024",
    "ownershipPercentage": 25.0,
    "investmentAmount": 375000000,
    "status": "Active",
    "acceptedAt": "2025-01-17T12:00:00Z"
  }
}
```

**Response 200 - T·ª´ ch·ªëi:**
```json
{
  "statusCode": 200,
  "message": "INVITATION_REJECTED_SUCCESSFULLY",
  "data": {
    "vehicleId": 15,
    "status": "Rejected",
    "rejectedAt": "2025-01-17T12:00:00Z"
  }
}
```

---

### 4. üè† Xem xe c·ªßa t√¥i - GET `/my-vehicles`

**M√¥ t·∫£:** L·∫•y danh s√°ch t·∫•t c·∫£ xe m√† user hi·ªán t·∫°i s·ªü h·ªØu ho·∫∑c ƒë·ªìng s·ªü h·ªØu.

**Role:** Co-owner

**Query Parameters:** Kh√¥ng c√≥

**Response 200 - Th√†nh c√¥ng:**
```json
{
  "statusCode": 200,
  "message": "USER_VEHICLES_RETRIEVED_SUCCESSFULLY",
  "data": [
    {
      "vehicleId": 15,
      "name": "Tesla Model 3 2024",
      "brand": "Tesla",
      "model": "Model 3",
      "licensePlate": "51A-12345",
      "status": "Available",
      "verificationStatus": "Verified",
      "myOwnershipPercentage": 75.0,
      "myInvestmentAmount": 1125000000,
      "myRole": "Creator",
      "totalCoOwners": 2,
      "availableOwnershipPercentage": 0.0,
      "currentBalance": 8500000,
      "lastActivityAt": "2025-01-16T14:30:00Z"
    }
  ]
}
```

**Use Cases:**
- Dashboard "Xe c·ªßa t√¥i"
- Portfolio qu·∫£n l√Ω ƒë·∫ßu t∆∞
- Ki·ªÉm tra t√¨nh tr·∫°ng s·ªü h·ªØu

---

### 5. üì® Xem l·ªùi m·ªùi ch·ªù duy·ªát - GET `/invitations/pending`

**M√¥ t·∫£:** L·∫•y danh s√°ch l·ªùi m·ªùi ƒë·ªìng s·ªü h·ªØu ch·ªù ph·∫£n h·ªìi.

**Role:** Co-owner

**Response 200 - Th√†nh c√¥ng:**
```json
{
  "statusCode": 200,
  "message": "PENDING_INVITATIONS_RETRIEVED_SUCCESSFULLY",
  "data": [
    {
      "invitationId": 25,
      "vehicleId": 15,
      "vehicleName": "Tesla Model 3 2024",
      "vehicleBrand": "Tesla",
      "vehicleModel": "Model 3",
      "licensePlate": "51A-12345",
      "inviterName": "Nguyen Van A",
      "ownershipPercentage": 25.0,
      "investmentAmount": 375000000,
      "createdAt": "2025-01-17T11:00:00Z",
      "expiresAt": "2025-01-24T11:00:00Z"
    }
  ]
}
```

---

### 6. üóëÔ∏è X√≥a ƒë·ªìng s·ªü h·ªØu - DELETE `/{vehicleId}/co-owners/{coOwnerUserId}`

**M√¥ t·∫£:** X√≥a m·ªôt ƒë·ªìng s·ªü h·ªØu kh·ªèi xe (ch·ªâ creator m·ªõi ƒë∆∞·ª£c x√≥a).

**Role:** Co-owner, Staff, Admin

**Path Parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| vehicleId | int | ‚úÖ | ID c·ªßa xe |
| coOwnerUserId | int | ‚úÖ | ID c·ªßa co-owner c·∫ßn x√≥a |

**Response 200 - Th√†nh c√¥ng:**
```json
{
  "statusCode": 200,
  "message": "CO_OWNER_REMOVED_SUCCESSFULLY",
  "data": {
    "vehicleId": 15,
    "removedUserId": 8,
    "removedUserName": "Tran Thi B",
    "ownershipPercentageFreed": 25.0,
    "newAvailablePercentage": 25.0
  }
}
```

**Business Rules:**
- Ch·ªâ creator c·ªßa xe m·ªõi c√≥ th·ªÉ x√≥a co-owner
- Kh√¥ng th·ªÉ x√≥a co-owner cu·ªëi c√πng (ph·∫£i c√≥ √≠t nh·∫•t 1 active owner)
- X√≥a s·∫Ω gi·∫£i ph√≥ng ownership percentage

---

### 7. üîÑ C·∫≠p nh·∫≠t th√¥ng tin xe - PUT `/{vehicleId}`

**M√¥ t·∫£:** C·∫≠p nh·∫≠t th√¥ng tin xe (ch·ªâ co-owner active m·ªõi ƒë∆∞·ª£c c·∫≠p nh·∫≠t).

**Role:** Co-owner, Staff, Admin

**Request Body:** Gi·ªëng nh∆∞ t·∫°o xe nh∆∞ng c√°c field ƒë·ªÅu optional
```json
{
  "name": "Tesla Model 3 2024 Updated",
  "color": "Midnight Silver",
  "latitude": 10.762622,
  "longitude": 106.660172
}
```

**Response 200 - Th√†nh c√¥ng:**
```json
{
  "statusCode": 200,
  "message": "VEHICLE_UPDATED_SUCCESSFULLY",
  "data": {
    "vehicleId": 15,
    "name": "Tesla Model 3 2024 Updated",
    "color": "Midnight Silver",
    "updatedAt": "2025-01-17T13:00:00Z"
  }
}
```

**L∆∞u √Ω:** VIN v√† license plate kh√¥ng th·ªÉ thay ƒë·ªïi v√¨ l√† ƒë·ªãnh danh duy nh·∫•t.

---

### 8. üîç Xem xe kh·∫£ d·ª•ng (v·ªõi filter) - GET `/available`

**M√¥ t·∫£:** L·∫•y danh s√°ch xe kh·∫£ d·ª•ng v·ªõi filtering v√† pagination n√¢ng cao.

**Role-based Access:**
- **Co-owner**: Ch·ªâ xem xe trong groups m√¨nh tham gia
- **Staff/Admin**: Xem t·∫•t c·∫£ xe trong h·ªá th·ªëng

**Query Parameters:**
| Parameter | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| pageIndex | int | ‚ùå | 1 | S·ªë trang |
| pageSize | int | ‚ùå | 10 | Items per page (max: 50) |
| status | string | ‚ùå | Available | Available, InUse, Maintenance, Unavailable |
| verificationStatus | string | ‚ùå | Verified | Pending, Verified, Rejected, etc. |
| brand | string | ‚ùå | null | Filter theo th∆∞∆°ng hi·ªáu (partial match) |
| model | string | ‚ùå | null | Filter theo model (partial match) |
| minYear | int | ‚ùå | null | NƒÉm s·∫£n xu·∫•t t·ªëi thi·ªÉu |
| maxYear | int | ‚ùå | null | NƒÉm s·∫£n xu·∫•t t·ªëi ƒëa |
| minPrice | decimal | ‚ùå | null | Gi√° mua t·ªëi thi·ªÉu (VND) |
| maxPrice | decimal | ‚ùå | null | Gi√° mua t·ªëi ƒëa (VND) |
| search | string | ‚ùå | null | T√¨m ki·∫øm t·ªïng h·ª£p (name, brand, model, VIN, plate) |
| sortBy | string | ‚ùå | createdAt | name, brand, model, year, price, createdAt |
| sortDesc | boolean | ‚ùå | true | true = descending, false = ascending |

**Response 200 - Th√†nh c√¥ng:**
```json
{
  "statusCode": 200,
  "message": "AVAILABLE_VEHICLES_RETRIEVED_SUCCESSFULLY",
  "data": {
    "items": [
      {
        "vehicleId": 15,
        "name": "Tesla Model 3 2024",
        "brand": "Tesla",
        "model": "Model 3",
        "year": 2024,
        "licensePlate": "51A-12345",
        "color": "Pearl White",
        "range": 448,
        "status": "Available",
        "verificationStatus": "Verified",
        "purchasePrice": 1500000000,
        "availableOwnershipPercentage": 25.0,
        "totalCoOwners": 2,
        "currentUtilizationRate": 24.5,
        "location": {
          "latitude": 10.762622,
          "longitude": 106.660172
        },
        "coOwners": [
          {
            "userId": 5,
            "fullName": "Nguyen Van A",
            "ownershipPercentage": 75.0,
            "isCreator": true
          }
        ]
      }
    ],
    "pageIndex": 1,
    "pageSize": 10,
    "totalCount": 25,
    "totalPages": 3,
    "hasPreviousPage": false,
    "hasNextPage": true
  }
}
```

**Example Requests:**

**1. T√¨m xe Tesla:**
```
GET /api/vehicle/available?brand=Tesla&sortBy=price&sortDesc=false
```

**2. Xe trong kho·∫£ng gi√° 1-2 t·ª∑:**
```
GET /api/vehicle/available?minPrice=1000000000&maxPrice=2000000000
```

**3. Xe s·∫£n xu·∫•t t·ª´ 2022:**
```
GET /api/vehicle/available?minYear=2022&sortBy=year&sortDesc=true
```

**4. T√¨m ki·∫øm "VF8":**
```
GET /api/vehicle/available?search=VF8
```

---

### 9. üìÑ Xem chi ti·∫øt xe ƒë·∫ßy ƒë·ªß - GET `/{vehicleId}`

**M√¥ t·∫£:** L·∫•y th√¥ng tin chi ti·∫øt ƒë·∫ßy ƒë·ªß c·ªßa xe bao g·ªìm fund, co-owners, specifications.

**Role:** Co-owner (ch·ªâ xe m√¨nh tham gia), Staff/Admin (m·ªçi xe)

**Response 200 - Th√†nh c√¥ng:**
```json
{
  "statusCode": 200,
  "message": "VEHICLE_DETAIL_RETRIEVED_SUCCESSFULLY",
  "data": {
    "vehicle": {
      "vehicleId": 15,
      "name": "Tesla Model 3 2024",
      "brand": "Tesla",
      "model": "Model 3",
      "year": 2024,
      "vin": "1HGCM82633A123456",
      "licensePlate": "51A-12345",
      "color": "Pearl White",
      "batteryCapacity": 75.0,
      "range": 448,
      "distanceTravelled": 1250,
      "status": "Available",
      "verificationStatus": "Verified",
      "purchaseDate": "2024-01-15T00:00:00Z",
      "purchasePrice": 1500000000,
      "warrantyExpiryDate": "2027-01-15T00:00:00Z",
      "location": {
        "latitude": 10.762622,
        "longitude": 106.660172
      },
      "createdAt": "2024-01-15T10:30:00Z",
      "updatedAt": "2025-01-17T13:00:00Z"
    },
    "coOwners": [
      {
        "userId": 5,
        "fullName": "Nguyen Van A",
        "email": "nguyenvana@example.com",
        "phone": "0901234567",
        "ownershipPercentage": 75.0,
        "investmentAmount": 1125000000,
        "status": "Active",
        "isCreator": true,
        "joinedAt": "2024-01-15T10:30:00Z"
      },
      {
        "userId": 8,
        "fullName": "Tran Thi B",
        "email": "tranthib@example.com",
        "phone": "0901234568",
        "ownershipPercentage": 25.0,
        "investmentAmount": 375000000,
        "status": "Active",
        "isCreator": false,
        "joinedAt": "2025-01-17T12:00:00Z"
      }
    ],
    "totalOwnership": 100.0,
    "availableOwnership": 0.0,
    "fund": {
      "fundId": 8,
      "currentBalance": 8500000,
      "totalAddedAmount": 15000000,
      "totalUsedAmount": 6500000,
      "totalAdditions": 12,
      "totalUsages": 8,
      "balanceStatus": "Healthy",
      "recommendedMinBalance": 5000000,
      "createdAt": "2024-01-20T00:00:00Z",
      "updatedAt": "2025-01-16T14:25:00Z"
    },
    "creator": {
      "userId": 5,
      "fullName": "Nguyen Van A",
      "email": "nguyenvana@example.com"
    }
  }
}
```

---

### 10. üìÖ Xem l·ªãch tr√¨nh s·ª≠ d·ª•ng xe - GET `/{vehicleId}/availability/schedule`

**M√¥ t·∫£:** Xem l·ªãch tr√¨nh s·ª≠ d·ª•ng xe trong kho·∫£ng th·ªùi gian c·ª• th·ªÉ, bi·∫øt khi n√†o xe b·∫≠n/r·∫£nh.

**Role:** Co-owner (xe m√¨nh tham gia), Staff/Admin

**Query Parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| startDate | DateTime | ‚úÖ | Ng√†y b·∫Øt ƒë·∫ßu (yyyy-MM-dd) |
| endDate | DateTime | ‚úÖ | Ng√†y k·∫øt th√∫c (yyyy-MM-dd, max 90 days) |
| statusFilter | string | ‚ùå | Filter booking status (Confirmed, Pending, etc.) |

**Response 200 - Th√†nh c√¥ng:**
```json
{
  "statusCode": 200,
  "message": "VEHICLE_AVAILABILITY_SCHEDULE_RETRIEVED_SUCCESSFULLY",
  "data": {
    "vehicle": {
      "vehicleId": 15,
      "name": "Tesla Model 3 2024",
      "licensePlate": "51A-12345",
      "status": "Available"
    },
    "period": {
      "startDate": "2025-01-17T00:00:00Z",
      "endDate": "2025-01-24T23:59:59Z",
      "totalDays": 8
    },
    "bookedSlots": [
      {
        "bookingId": 125,
        "coOwnerName": "Nguyen Van A",
        "startTime": "2025-01-18T08:00:00Z",
        "endTime": "2025-01-18T18:00:00Z",
        "duration": 10.0,
        "purpose": "ƒêi c√¥ng t√°c ƒê√† N·∫µng",
        "status": "Confirmed"
      },
      {
        "bookingId": 126,
        "coOwnerName": "Tran Thi B",
        "startTime": "2025-01-20T14:00:00Z",
        "endTime": "2025-01-20T20:00:00Z",
        "duration": 6.0,
        "purpose": "D·ª± ti·ªác c∆∞·ªõi",
        "status": "Confirmed"
      }
    ],
    "availableDays": [
      "2025-01-17",
      "2025-01-19", 
      "2025-01-21",
      "2025-01-22",
      "2025-01-23",
      "2025-01-24"
    ],
    "utilization": {
      "totalHoursInPeriod": 192,
      "bookedHours": 16.0,
      "utilizationPercentage": 8.33,
      "totalBookings": 2,
      "confirmedBookings": 2,
      "averageBookingDuration": 8.0
    }
  }
}
```

**Use Cases:**
- L·∫≠p k·∫ø ho·∫°ch ƒë·∫∑t xe
- Xem ai ƒëang s·ª≠ d·ª•ng xe khi n√†o
- Ph√¢n t√≠ch m·ª©c ƒë·ªô s·ª≠ d·ª•ng xe

---

### 11. üîç T√¨m slot tr·ªëng - GET `/{vehicleId}/availability/find-slots`

**M√¥ t·∫£:** T·ª± ƒë·ªông t√¨m c√°c khung th·ªùi gian xe r·∫£nh ƒë·ªÉ ƒë·∫∑t.

**Role:** Co-owner (xe m√¨nh tham gia), Staff/Admin

**Query Parameters:**
| Parameter | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| startDate | DateTime | ‚úÖ | - | Ng√†y b·∫Øt ƒë·∫ßu t√¨m |
| endDate | DateTime | ‚úÖ | - | Ng√†y k·∫øt th√∫c t√¨m |
| minimumDurationHours | int | ‚ùå | 1 | Th·ªùi gian t·ªëi thi·ªÉu c·∫ßn (max: 24) |
| fullDayOnly | boolean | ‚ùå | false | Ch·ªâ t√¨m slot ‚â•8 ti·∫øng |

**Response 200 - Th√†nh c√¥ng:**
```json
{
  "statusCode": 200,
  "message": "AVAILABLE_TIME_SLOTS_FOUND_SUCCESSFULLY",
  "data": {
    "vehicle": {
      "vehicleId": 15,
      "name": "Tesla Model 3 2024",
      "licensePlate": "51A-12345"
    },
    "searchCriteria": {
      "startDate": "2025-01-17T00:00:00Z",
      "endDate": "2025-01-24T23:59:59Z",
      "minimumDurationHours": 4,
      "fullDayOnly": false
    },
    "availableSlots": [
      {
        "startTime": "2025-01-17T00:00:00Z",
        "endTime": "2025-01-17T23:59:59Z",
        "durationHours": 24.0,
        "isFullDay": true,
        "recommendation": "C·∫£ ng√†y 17/1 ƒë·ªÅu r·∫£nh"
      },
      {
        "startTime": "2025-01-18T18:00:00Z",
        "endTime": "2025-01-18T23:59:59Z",
        "durationHours": 6.0,
        "isFullDay": false,
        "recommendation": "6 ti·∫øng t·ªëi 18/1 sau booking"
      },
      {
        "startTime": "2025-01-19T00:00:00Z",
        "endTime": "2025-01-19T23:59:59Z",
        "durationHours": 24.0,
        "isFullDay": true,
        "recommendation": "C·∫£ ng√†y 19/1 ƒë·ªÅu r·∫£nh"
      }
    ],
    "totalSlotsFound": 3,
    "message": "T√¨m th·∫•y 3 khung th·ªùi gian ph√π h·ª£p"
  }
}
```

**Use Cases:**
- "T√¥i c·∫ßn xe 4 ti·∫øng tu·∫ßn t·ªõi"
- "T√¨m ng√†y n√†o xe r·∫£nh c·∫£ ng√†y"
- "Khi n√†o c√≥ th·ªÉ ƒë·∫∑t xe cho chuy·∫øn ƒëi ng·∫Øn"

---

### 12. üìä So s√°nh hi·ªáu su·∫•t s·ª≠ d·ª•ng - GET `/utilization/compare`

**M√¥ t·∫£:** So s√°nh m·ª©c ƒë·ªô s·ª≠ d·ª•ng c·ªßa c√°c xe trong group/to√†n h·ªá th·ªëng.

**Role-based Access:**
- **Co-owner**: So s√°nh xe trong groups m√¨nh tham gia
- **Staff/Admin**: So s√°nh t·∫•t c·∫£ xe

**Query Parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| startDate | DateTime | ‚úÖ | Ng√†y b·∫Øt ƒë·∫ßu ph√¢n t√≠ch |
| endDate | DateTime | ‚úÖ | Ng√†y k·∫øt th√∫c ph√¢n t√≠ch |

**Response 200 - Th√†nh c√¥ng:**
```json
{
  "statusCode": 200,
  "message": "VEHICLE_UTILIZATION_COMPARISON_RETRIEVED_SUCCESSFULLY",
  "data": {
    "period": {
      "startDate": "2025-01-01T00:00:00Z",
      "endDate": "2025-01-31T23:59:59Z",
      "totalDays": 31
    },
    "vehicles": [
      {
        "vehicleId": 15,
        "vehicleName": "Tesla Model 3 2024",
        "licensePlate": "51A-12345",
        "utilizationPercentage": 65.2,
        "totalBookings": 18,
        "totalBookedHours": 486.5,
        "totalAvailableHours": 744,
        "averageBookingDuration": 27.0,
        "mostActiveDay": "Saturday",
        "rank": 1
      },
      {
        "vehicleId": 12,
        "vehicleName": "VinFast VF8 2023",
        "licensePlate": "51B-67890",
        "utilizationPercentage": 45.3,
        "totalBookings": 14,
        "totalBookedHours": 337.1,
        "totalAvailableHours": 744,
        "averageBookingDuration": 24.1,
        "mostActiveDay": "Sunday",
        "rank": 2
      },
      {
        "vehicleId": 8,
        "vehicleName": "BMW i4 2022",
        "licensePlate": "50A-11111",
        "utilizationPercentage": 20.1,
        "totalBookings": 8,
        "totalBookedHours": 149.5,
        "totalAvailableHours": 744,
        "averageBookingDuration": 18.7,
        "mostActiveDay": "Friday",
        "rank": 3
      }
    ],
    "summary": {
      "totalVehicles": 3,
      "highestUtilization": {
        "vehicleId": 15,
        "vehicleName": "Tesla Model 3 2024",
        "utilizationPercentage": 65.2
      },
      "lowestUtilization": {
        "vehicleId": 8,
        "vehicleName": "BMW i4 2022",
        "utilizationPercentage": 20.1
      },
      "averageUtilization": 43.5,
      "totalBookings": 40,
      "totalBookedHours": 973.1
    },
    "insights": [
      "Tesla Model 3 l√† xe ƒë∆∞·ª£c s·ª≠ d·ª•ng nhi·ªÅu nh·∫•t (65.2%)",
      "BMW i4 √≠t ƒë∆∞·ª£c s·ª≠ d·ª•ng (20.1%) - c√≥ th·ªÉ c√¢n nh·∫Øc gi·∫£m ownership",
      "Trung b√¨nh fleet: 43.5% utilization"
    ]
  }
}
```

**Use Cases:**
- **Fleet Management**: Xe n√†o hot, xe n√†o ·∫ø
- **Investment Decision**: N√™n tƒÉng hay gi·∫£m ownership
- **Booking Strategy**: Ch·ªçn xe √≠t b·∫≠n ƒë·ªÉ d·ªÖ ƒë·∫∑t

---

### 13. üß™ [Development] Ki·ªÉm tra ƒëi·ªÅu ki·ªán t·∫°o xe - GET `/validate-creation-eligibility`

**M√¥ t·∫£:** Ki·ªÉm tra user hi·ªán t·∫°i c√≥ ƒë·ªß ƒëi·ªÅu ki·ªán t·∫°o xe kh√¥ng (endpoint test).

**Response 200 - ƒê·ªß ƒëi·ªÅu ki·ªán:**
```json
{
  "statusCode": 200,
  "message": "USER_ELIGIBLE_TO_CREATE_VEHICLE",
  "data": {
    "userId": 5,
    "isEligible": true,
    "userRole": "CoOwner",
    "hasVerifiedLicense": true,
    "licenseExpiryDate": "2028-05-15T00:00:00Z",
    "checks": {
      "hasCoOwnerRole": true,
      "hasActiveLicense": true,
      "licenseVerified": true,
      "licenseNotExpired": true
    }
  }
}
```

**Response 400 - Kh√¥ng ƒë·ªß ƒëi·ªÅu ki·ªán:**
```json
{
  "statusCode": 400,
  "message": "USER_NOT_ELIGIBLE_TO_CREATE_VEHICLE",
  "data": {
    "userId": 5,
    "isEligible": false,
    "reasons": [
      "NO_DRIVING_LICENSE_REGISTERED",
      "USER_ROLE_NOT_CO_OWNER"
    ]
  }
}
```

---

## üî¢ Enums v√† Constants

### Vehicle Status (EVehicleStatus)
```typescript
enum EVehicleStatus {
  Available = 0,     // Xe s·∫µn s√†ng s·ª≠ d·ª•ng
  InUse = 1,        // ƒêang ƒë∆∞·ª£c s·ª≠ d·ª•ng (c√≥ booking active)
  Maintenance = 2,   // ƒêang b·∫£o d∆∞·ª°ng
  Unavailable = 3    // Kh√¥ng kh·∫£ d·ª•ng v√¨ l√Ω do kh√°c
}
```

### Verification Status (EVerificationStatus)
```typescript
enum EVerificationStatus {
  Pending = 0,              // Ch·ªù x√°c minh
  VerificationRequested = 1, // ƒê√£ y√™u c·∫ßu x√°c minh
  RequiresRecheck = 2,      // C·∫ßn ki·ªÉm tra l·∫°i
  Verified = 3,             // ƒê√£ x√°c minh th√†nh c√¥ng
  Rejected = 4              // X√°c minh b·ªã t·ª´ ch·ªëi
}
```

### Co-Owner Status (ECoOwnerStatus)
```typescript
enum ECoOwnerStatus {
  Active = 0,    // ƒê·ªìng s·ªü h·ªØu ƒëang ho·∫°t ƒë·ªông
  Pending = 1,   // Ch·ªù ph·∫£n h·ªìi l·ªùi m·ªùi
  Rejected = 2,  // ƒê√£ t·ª´ ch·ªëi l·ªùi m·ªùi
  Inactive = 3   // Kh√¥ng ho·∫°t ƒë·ªông (b·ªã x√≥a)
}
```

---

## ‚ùå Error Codes

### Vehicle Creation Errors (4xx)
| Status | Code | Message | √ù nghƒ©a |
|--------|------|---------|---------|
| 400 | Bad Request | `USER_NOT_ELIGIBLE_TO_CREATE_VEHICLE` | User kh√¥ng ƒë·ªß ƒëi·ªÅu ki·ªán t·∫°o xe |
| 400 | Bad Request | `NO_DRIVING_LICENSE_REGISTERED` | Ch∆∞a ƒëƒÉng k√Ω b·∫±ng l√°i xe |
| 400 | Bad Request | `DRIVING_LICENSE_NOT_VERIFIED` | B·∫±ng l√°i xe ch∆∞a ƒë∆∞·ª£c x√°c minh |
| 400 | Bad Request | `DRIVING_LICENSE_EXPIRED` | B·∫±ng l√°i xe ƒë√£ h·∫øt h·∫°n |
| 409 | Conflict | `LICENSE_PLATE_ALREADY_EXISTS` | Bi·ªÉn s·ªë xe ƒë√£ t·ªìn t·∫°i |
| 409 | Conflict | `VIN_ALREADY_EXISTS` | S·ªë VIN ƒë√£ t·ªìn t·∫°i |

### Co-ownership Errors (4xx)
| Status | Code | Message | √ù nghƒ©a |
|--------|------|---------|---------|
| 400 | Bad Request | `TARGET_USER_NOT_CO_OWNER` | User ƒë∆∞·ª£c m·ªùi kh√¥ng c√≥ role Co-owner |
| 400 | Bad Request | `OWNERSHIP_PERCENTAGE_EXCEEDS_LIMIT` | V∆∞·ª£t qu√° t·ª∑ l·ªá s·ªü h·ªØu c√≤n l·∫°i |
| 409 | Conflict | `USER_ALREADY_CO_OWNER_OF_VEHICLE` | User ƒë√£ l√† ƒë·ªìng s·ªü h·ªØu c·ªßa xe |
| 409 | Conflict | `INVITATION_ALREADY_PENDING` | ƒê√£ c√≥ l·ªùi m·ªùi ch·ªù duy·ªát |
| 404 | Not Found | `INVITATION_NOT_FOUND` | Kh√¥ng t√¨m th·∫•y l·ªùi m·ªùi |

### Access Control Errors (4xx)
| Status | Code | Message | √ù nghƒ©a |
|--------|------|---------|---------|
| 403 | Forbidden | `ACCESS_DENIED_NOT_VEHICLE_CO_OWNER` | Kh√¥ng ph·∫£i ƒë·ªìng s·ªü h·ªØu c·ªßa xe |
| 403 | Forbidden | `ACCESS_DENIED_ONLY_CREATOR_CAN_REMOVE` | Ch·ªâ creator m·ªõi c√≥ th·ªÉ x√≥a co-owner |
| 403 | Forbidden | `ACCESS_DENIED_INSUFFICIENT_PERMISSIONS` | Kh√¥ng ƒë·ªß quy·ªÅn th·ª±c hi·ªán |

### System Errors (5xx)
| Status | Code | √ù nghƒ©a |
|--------|------|---------|
| 500 | Internal Server Error | `INTERNAL_SERVER_ERROR` | L·ªói h·ªá th·ªëng |

---

## üí° V√≠ d·ª• s·ª≠ d·ª•ng

### Use Case 1: Flow t·∫°o xe v√† m·ªùi ƒë·ªìng s·ªü h·ªØu

```javascript
// 1. Ki·ªÉm tra ƒëi·ªÅu ki·ªán t·∫°o xe
const eligibilityResponse = await fetch('/api/vehicle/validate-creation-eligibility', {
  headers: { 'Authorization': `Bearer ${token}` }
});

if (eligibilityResponse.ok) {
  // 2. T·∫°o xe m·ªõi
  const createResponse = await fetch('/api/vehicle', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      name: 'Tesla Model 3 2024',
      brand: 'Tesla',
      model: 'Model 3',
      year: 2024,
      vin: '1HGCM82633A123456',
      licensePlate: '51A-12345',
      color: 'Pearl White',
      batteryCapacity: 75.0,
      range: 448,
      purchaseDate: '2024-01-15',
      purchasePrice: 1500000000
    })
  });

  const vehicleData = await createResponse.json();
  const vehicleId = vehicleData.data.vehicleId;

  // 3. M·ªùi ƒë·ªìng s·ªü h·ªØu
  const inviteResponse = await fetch(`/api/vehicle/${vehicleId}/co-owners`, {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      userId: 8,
      ownershipPercentage: 25.0,
      investmentAmount: 375000000
    })
  });

  console.log('Invitation sent!');
}
```

### Use Case 2: Xem v√† ph·∫£n h·ªìi l·ªùi m·ªùi

```javascript
// 1. Xem l·ªùi m·ªùi ch·ªù duy·ªát
const invitationsResponse = await fetch('/api/vehicle/invitations/pending', {
  headers: { 'Authorization': `Bearer ${token}` }
});

const invitations = await invitationsResponse.json();

// 2. Ph·∫£n h·ªìi l·ªùi m·ªùi (ch·∫•p nh·∫≠n)
for (const invitation of invitations.data) {
  const respondResponse = await fetch(`/api/vehicle/${invitation.vehicleId}/invitations/respond`, {
    method: 'PUT',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      response: true  // true = accept, false = reject
    })
  });

  if (respondResponse.ok) {
    console.log(`Accepted invitation for ${invitation.vehicleName}`);
  }
}
```

### Use Case 3: T√¨m xe v√† l√™n k·∫ø ho·∫°ch booking

```javascript
// 1. T√¨m xe Tesla trong kho·∫£ng gi√° 1-2 t·ª∑
const searchResponse = await fetch('/api/vehicle/available?brand=Tesla&minPrice=1000000000&maxPrice=2000000000&sortBy=price', {
  headers: { 'Authorization': `Bearer ${token}` }
});

const vehicles = await searchResponse.json();
const selectedVehicle = vehicles.data.items[0];

// 2. Xem l·ªãch tr√¨nh xe tu·∫ßn t·ªõi
const scheduleResponse = await fetch(`/api/vehicle/${selectedVehicle.vehicleId}/availability/schedule?startDate=2025-01-17&endDate=2025-01-24`, {
  headers: { 'Authorization': `Bearer ${token}` }
});

const schedule = await scheduleResponse.json();
console.log('Available days:', schedule.data.availableDays);

// 3. T√¨m slot 4 ti·∫øng ƒë·ªÉ ƒë·∫∑t xe
const slotsResponse = await fetch(`/api/vehicle/${selectedVehicle.vehicleId}/availability/find-slots?startDate=2025-01-17&endDate=2025-01-24&minimumDurationHours=4`, {
  headers: { 'Authorization': `Bearer ${token}` }
});

const slots = await slotsResponse.json();
console.log('Available 4-hour slots:', slots.data.availableSlots);
```

### Use Case 4: Qu·∫£n l√Ω portfolio xe

```javascript
// 1. Xem danh s√°ch xe c·ªßa t√¥i
const myVehiclesResponse = await fetch('/api/vehicle/my-vehicles', {
  headers: { 'Authorization': `Bearer ${token}` }
});

const myVehicles = await myVehiclesResponse.json();

// 2. Xem chi ti·∫øt t·ª´ng xe
for (const vehicle of myVehicles.data) {
  const detailResponse = await fetch(`/api/vehicle/${vehicle.vehicleId}`, {
    headers: { 'Authorization': `Bearer ${token}` }
  });

  const detail = await detailResponse.json();
  
  console.log(`${vehicle.name}:`);
  console.log(`- My ownership: ${vehicle.myOwnershipPercentage}%`);
  console.log(`- Investment: ${vehicle.myInvestmentAmount.toLocaleString()} VND`);
  console.log(`- Fund balance: ${detail.data.fund.currentBalance.toLocaleString()} VND`);
  console.log(`- Co-owners: ${detail.data.coOwners.length}`);
}

// 3. So s√°nh hi·ªáu su·∫•t s·ª≠ d·ª•ng c√°c xe
const utilizationResponse = await fetch('/api/vehicle/utilization/compare?startDate=2025-01-01&endDate=2025-01-31', {
  headers: { 'Authorization': `Bearer ${token}` }
});

const utilization = await utilizationResponse.json();
console.log('Utilization ranking:');
utilization.data.vehicles.forEach(v => {
  console.log(`${v.rank}. ${v.vehicleName}: ${v.utilizationPercentage}%`);
});
```

---

## üîê Best Practices

### 1. Role-based UI

```javascript
// Hi·ªÉn th·ªã ch·ª©c nƒÉng theo role
const userRole = getUserRole(); // Co-owner, Staff, Admin

if (userRole === 'Co-owner') {
  // Ch·ªâ hi·ªÉn th·ªã xe trong groups m√¨nh tham gia
  showMyGroupVehicles();
  showCreateVehicleButton();
  showInvitationManagement();
} else if (userRole === 'Staff' || userRole === 'Admin') {
  // Hi·ªÉn th·ªã t·∫•t c·∫£ xe
  showAllVehicles();
  showAdvancedManagement();
}
```

### 2. Optimistic UI cho invitations

```javascript
// Hi·ªÉn th·ªã ngay khi g·ª≠i l·ªùi m·ªùi, update khi c√≥ response
async function inviteCoOwner(vehicleId, userId, percentage, amount) {
  // 1. Update UI optimistic
  showPendingInvitation(userId, percentage);

  try {
    // 2. G·ª≠i request
    const response = await fetch(`/api/vehicle/${vehicleId}/co-owners`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ userId, ownershipPercentage: percentage, investmentAmount: amount })
    });

    if (response.ok) {
      showSuccessMessage('L·ªùi m·ªùi ƒë√£ ƒë∆∞·ª£c g·ª≠i');
    } else {
      // 3. Rollback n·∫øu l·ªói
      hidePendingInvitation(userId);
      showErrorMessage('Kh√¥ng th·ªÉ g·ª≠i l·ªùi m·ªùi');
    }
  } catch (error) {
    hidePendingInvitation(userId);
    showErrorMessage('L·ªói k·∫øt n·ªëi');
  }
}
```

### 3. Smart filtering v√† caching

```javascript
// Cache k·∫øt qu·∫£ search ƒë·ªÉ tr√°nh g·ªçi API li√™n t·ª•c
const searchCache = new Map();

async function searchVehicles(filters) {
  const cacheKey = JSON.stringify(filters);
  
  if (searchCache.has(cacheKey)) {
    return searchCache.get(cacheKey);
  }

  const queryString = new URLSearchParams(filters).toString();
  const response = await fetch(`/api/vehicle/available?${queryString}`, {
    headers: { 'Authorization': `Bearer ${token}` }
  });

  const data = await response.json();
  
  // Cache trong 5 ph√∫t
  searchCache.set(cacheKey, data);
  setTimeout(() => searchCache.delete(cacheKey), 5 * 60 * 1000);

  return data;
}
```

### 4. Real-time availability updates

```javascript
// WebSocket ho·∫∑c polling ƒë·ªÉ update availability real-time
function setupAvailabilityUpdates(vehicleId) {
  setInterval(async () => {
    const response = await fetch(`/api/vehicle/${vehicleId}/availability/schedule?startDate=${today}&endDate=${nextWeek}`, {
      headers: { 'Authorization': `Bearer ${token}` }
    });

    const data = await response.json();
    updateCalendarView(data.data.bookedSlots);
  }, 30000); // Update every 30 seconds
}
```

---

## üìû Li√™n h·ªá v√† H·ªó tr·ª£

- **API Documentation:** http://localhost:5215/swagger
- **Backend Team:** [Your team contact]
- **Issues:** [GitHub Issues URL]

---

**Last Updated:** 2025-01-17  
**Version:** 2.0.0  
**Author:** Backend Development Team
````